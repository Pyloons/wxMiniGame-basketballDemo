{"version":3,"sources":["player.js"],"names":["cc","Class","extends","Component","properties","controller","type","Node","default","basketball","Prefab","score","onLoad","playerAction","getComponent","Animation","playerAnimStatus","play","deltaTime","hasReady","hasWait","hasShoot","stickX","stickY","stickStart","stickMove","stickRelease","on","event","detail","moveVector","x","y","start","update","dt","node","children","newBall","instantiate","joyStick","player","addChild","opacity","Date","now","stop","emit","shootAngle","p"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,oBAAY;AACRC,kBAAMN,GAAGO,IADD;AAERC,qBAAS;AAFD,SADJ;;AAMRC,oBAAY;AACRH,kBAAMN,GAAGU,MADD;AAERF,qBAAS;AAFD,SANJ;;AAWRG,eAAO;AACHL,kBAAMN,GAAGO,IADN;AAEHC,qBAAS;AAFN;AAXC,KAHP;;AAoBLI,UApBK,oBAoBI;AAAA;;AACL,aAAKC,YAAL,GAAoB,KAAKC,YAAL,CAAkBd,GAAGe,SAArB,CAApB;AACA,aAAKC,gBAAL,GAAwB,KAAKH,YAAL,CAAkBI,IAAlB,CAAuB,aAAvB,CAAxB;AACA,aAAKC,SAAL,GAAiB,CAAjB;AACA,aAAKC,QAAL,GAAgB,IAAhB;AACA,aAAKC,OAAL,GAAe,KAAf;AACA,aAAKC,QAAL,GAAgB,KAAhB;AACA,aAAKC,MAAL,GAAc,CAAd;AACA,aAAKC,MAAL,GAAc,CAAd;;AAEA;AACA,aAAKC,UAAL,GAAkB,KAAlB;AACA,aAAKC,SAAL,GAAiB,KAAjB;AACA,aAAKC,YAAL,GAAoB,KAApB;;AAEA,aAAKrB,UAAL,CAAgBsB,EAAhB,CAAmB,cAAnB,EAAmC,UAACC,KAAD,EAAW;AAC1C,gBAAIA,MAAMC,MAAN,CAAaC,UAAb,CAAwBC,CAAxB,IAA6B,CAA7B,IAAkCH,MAAMC,MAAN,CAAaC,UAAb,CAAwBE,CAAxB,IAA6B,CAAnE,EAAsE;AAClE,sBAAKV,MAAL,GAAcM,MAAMC,MAAN,CAAaC,UAAb,CAAwBC,CAAtC;AACA,sBAAKR,MAAL,GAAcK,MAAMC,MAAN,CAAaC,UAAb,CAAwBE,CAAtC;AACH;AACJ,SALD;;AAOA,aAAK3B,UAAL,CAAgBsB,EAAhB,CAAmB,YAAnB,EAAiC,YAAM;AACnC,kBAAKH,UAAL,GAAkB,IAAlB;AACH,SAFD;AAGA,aAAKnB,UAAL,CAAgBsB,EAAhB,CAAmB,WAAnB,EAAgC,YAAM;AAClC,kBAAKF,SAAL,GAAiB,IAAjB;AACH,SAFD;AAGA,aAAKpB,UAAL,CAAgBsB,EAAhB,CAAmB,cAAnB,EAAmC,YAAM;AACrC,kBAAKD,YAAL,GAAoB,IAApB;AACH,SAFD;;AAIA;AACA,aAAKf,KAAL,CAAWgB,EAAX,CAAc,SAAd,EAAyB,UAACC,KAAD,EAAW;AAChC;AACA,gBAAI,MAAKP,QAAL,IAAiB,MAAKK,YAA1B,EAAwC;AACpC,sBAAKP,QAAL,GAAgB,IAAhB;AACA,sBAAKE,QAAL,GAAgB,KAAhB;AACA,sBAAKC,MAAL,GAAc,CAAd;AACA,sBAAKC,MAAL,GAAc,CAAd;AACH;AACJ,SARD;AASH,KA9DI;AAgELU,SAhEK,mBAgEG,CAAE,CAhEL;AAkELC,UAlEK,kBAkEEC,EAlEF,EAkEM;;AAEP;AACA,YAAI,KAAKhB,QAAL,IAAiB,KAAKG,MAAL,IAAe,CAAhC,IAAqC,KAAKC,MAAL,IAAe,CAAxD,EAA2D;AACvD;AACA,iBAAKC,UAAL,GAAkB,KAAlB;AACA,iBAAKC,SAAL,GAAiB,KAAjB;AACA,iBAAKC,YAAL,GAAoB,KAApB;;AAEA;AACA,gBAAI,CAAC,KAAKU,IAAL,CAAUC,QAAV,CAAmB,CAAnB,CAAL,EAA4B;AACxB,oBAAIC,UAAUtC,GAAGuC,WAAH,CAAe,KAAK9B,UAApB,CAAd;AACA6B,wBAAQxB,YAAR,CAAqB,YAArB,EAAmC0B,QAAnC,GAA8C,KAAKnC,UAAnD;AACAiC,wBAAQxB,YAAR,CAAqB,YAArB,EAAmC2B,MAAnC,GAA4C,KAAKL,IAAjD;AACA,qBAAKA,IAAL,CAAUM,QAAV,CAAmBJ,OAAnB;AACH;;AAED,iBAAKF,IAAL,CAAUC,QAAV,CAAmB,CAAnB,EAAsBM,OAAtB,GAAgC,CAAhC;;AAEA,iBAAK9B,YAAL,CAAkBI,IAAlB,CAAuB,aAAvB;AACA,iBAAKC,SAAL,GAAiB0B,KAAKC,GAAL,EAAjB;AACH;;AAED;AApBA,aAqBK,IAAI,KAAK1B,QAAL,KAAkB,KAAKG,MAAL,IAAe,CAAf,IAAoB,KAAKC,MAAL,IAAe,CAArD,CAAJ,EAA6D;AAC9D;AACA,qBAAKV,YAAL,CAAkBiC,IAAlB;AACA,qBAAKjC,YAAL,CAAkBI,IAAlB,CAAuB,YAAvB;AACA,qBAAKE,QAAL,GAAgB,KAAhB;AACA,qBAAKC,OAAL,GAAe,IAAf;AACA,qBAAKgB,IAAL,CAAUC,QAAV,CAAmB,CAAnB,EAAsBM,OAAtB,GAAgC,GAAhC;AACH;;AAED;AATK,iBAUA,IAAI,KAAKvB,OAAL,IAAgB,KAAKM,YAAzB,EAAuC;AACxC;AACA,yBAAKR,SAAL,GAAiB0B,KAAKC,GAAL,KAAa,KAAK3B,SAAnC;AACA,yBAAKkB,IAAL,CAAUW,IAAV,CAAe,UAAf,EAA2B;AACvB7B,mCAAW,KAAKA,SADO;AAEvB8B,oCAAYhD,GAAGiD,CAAH,CAAK,KAAK3B,MAAV,EAAkB,KAAKC,MAAvB;AAFW,qBAA3B;AAIA,yBAAKV,YAAL,CAAkBiC,IAAlB;AACA,yBAAKjC,YAAL,CAAkBI,IAAlB,CAAuB,aAAvB;AACA,yBAAKG,OAAL,GAAe,KAAf;AACA,yBAAKC,QAAL,GAAgB,IAAhB;AACH;AACJ;AAhHI,CAAT","file":"player.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        controller: {\r\n            type: cc.Node,\r\n            default: null\r\n        },\r\n\r\n        basketball: {\r\n            type: cc.Prefab,\r\n            default: null\r\n        },\r\n\r\n        score: {\r\n            type: cc.Node,\r\n            default: null\r\n        }\r\n    },\r\n\r\n    onLoad() {\r\n        this.playerAction = this.getComponent(cc.Animation);\r\n        this.playerAnimStatus = this.playerAction.play('playerReady');\r\n        this.deltaTime = 0;\r\n        this.hasReady = true;\r\n        this.hasWait = false;\r\n        this.hasShoot = false;\r\n        this.stickX = 0;\r\n        this.stickY = 0;\r\n\r\n        // 记录摇杆状态\r\n        this.stickStart = false;\r\n        this.stickMove = false;\r\n        this.stickRelease = false;\r\n\r\n        this.controller.on('VirtualStick', (event) => {\r\n            if (event.detail.moveVector.x != 0 || event.detail.moveVector.y != 0) {\r\n                this.stickX = event.detail.moveVector.x;\r\n                this.stickY = event.detail.moveVector.y;\r\n            }\r\n        });\r\n\r\n        this.controller.on('stickStart', () => {\r\n            this.stickStart = true;\r\n        });\r\n        this.controller.on('stickMove', () => {\r\n            this.stickMove = true;\r\n        });\r\n        this.controller.on('stickRelease', () => {\r\n            this.stickRelease = true;\r\n        });\r\n\r\n        // 计分板叫球员恢复最开始的姿势\r\n        this.score.on('recover', (event) => {\r\n            // console.log('recover');\r\n            if (this.hasShoot && this.stickRelease) {\r\n                this.hasReady = true;\r\n                this.hasShoot = false;\r\n                this.stickX = 0;\r\n                this.stickY = 0;\r\n            }\r\n        });\r\n    },\r\n\r\n    start() {},\r\n\r\n    update(dt) {\r\n\r\n        // 摇杆初始位置，球员已经做好准备\r\n        if (this.hasReady && this.stickX == 0 && this.stickY == 0) {\r\n            // console.log('ready');\r\n            this.stickStart = false;\r\n            this.stickMove = false;\r\n            this.stickRelease = false;\r\n\r\n            // 如果player手里没球，就给他一个\r\n            if (!this.node.children[0]) {\r\n                let newBall = cc.instantiate(this.basketball);\r\n                newBall.getComponent('basketball').joyStick = this.controller;\r\n                newBall.getComponent('basketball').player = this.node;\r\n                this.node.addChild(newBall);\r\n            }\r\n\r\n            this.node.children[0].opacity = 0;\r\n\r\n            this.playerAction.play('playerReady');\r\n            this.deltaTime = Date.now();\r\n        }\r\n\r\n        // 摇杆被拉动，但未松开，球员等着投球\r\n        else if (this.hasReady && (this.stickX != 0 || this.stickY != 0)) {\r\n            // console.log('wait');\r\n            this.playerAction.stop();\r\n            this.playerAction.play('playerWait');\r\n            this.hasReady = false;\r\n            this.hasWait = true;\r\n            this.node.children[0].opacity = 255;\r\n        }\r\n        \r\n        // 摇杆已被拉动，并且松开，球员马上投出了球\r\n        else if (this.hasWait && this.stickRelease) {\r\n            // console.log('shoot');\r\n            this.deltaTime = Date.now() - this.deltaTime;\r\n            this.node.emit('shootNow', {\r\n                deltaTime: this.deltaTime,\r\n                shootAngle: cc.p(this.stickX, this.stickY)\r\n            });\r\n            this.playerAction.stop();\r\n            this.playerAction.play('playerShoot');\r\n            this.hasWait = false;\r\n            this.hasShoot = true;\r\n        }\r\n    },\r\n});"]}